<!-- templates/realtime_market.html -->
{% extends "base.html" %}

{% block content %}
<div class="space-y-6">
    <div class="bg-white rounded-lg shadow-md p-6">
        <!-- Header Section -->
        <div class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-2xl font-bold">Real-Time Trading Chart</h1>
                <div class="flex items-center mt-2">
                    <div id="connection-status" class="flex items-center text-sm">
                        <div class="w-2 h-2 bg-red-500 rounded-full mr-2" id="status-indicator"></div>
                        <span id="status-text">Connecting...</span>
                    </div>
                    <div id="last-updated" class="ml-4 text-sm text-gray-400">
                        Last update: <span id="update-time">--</span>
                    </div>
                    <div id="market-status" class="ml-4 text-sm">
                        <span id="market-status-text">--</span>
                    </div>
                </div>
            </div>
            <div class="space-x-2">
                <a href="{{ url_for('market') }}" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded">
                    Static View
                </a>
                <a href="{{ url_for('market_live') }}"
                   class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">
                    Basic Live
                </a>
                <a href="{{ url_for('instruments') }}"
                   class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded">
                    Browse Instruments
                </a>
            </div>
        </div>

        <!-- Current Symbol Info with Enhanced Display -->
        <div class="mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border">
            <div class="flex justify-between items-center">
                <div>
                    <div class="text-sm text-gray-500">Currently viewing:</div>
                    <div class="flex items-center">
                        <h2 class="text-xl font-semibold" id="current-symbol">
                            {% if instrument %}
                            {{ instrument.symbol }} - {{ instrument.name }}
                            {% else %}
                            {{ symbol or 'NSE:RELIANCE-EQ' }}
                            {% endif %}
                        </h2>
                        {% if instrument %}
                        <span class="ml-2 px-2 py-0.5 text-xs bg-blue-200 text-blue-800 rounded-full">{{ instrument.exchange }}</span>
                        {% endif %}
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-500">Total Updates</div>
                    <div class="text-lg font-bold" id="update-counter">0</div>
                </div>
            </div>
        </div>

        <!-- Enhanced Symbol Search -->
        <div class="mb-6">
            <h2 class="text-lg font-semibold mb-2">Search & Select Instrument</h2>
            <div class="relative">
                <input type="text" id="instrument-search"
                       placeholder="Search by symbol or name (e.g., RELIANCE, TCS, NIFTY50)"
                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <div id="search-loading" class="absolute right-3 top-2.5 hidden">
                    <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div>
                </div>
                <div id="search-results"
                     class="absolute z-10 w-full mt-1 bg-white shadow-lg rounded-md border border-gray-300 hidden max-h-60 overflow-y-auto"></div>
            </div>

            <!-- Popular Instruments with Categories -->
            <div class="mt-3">
                <div class="flex flex-wrap gap-2 items-center">
                    <span class="text-sm text-gray-500 font-medium">Quick Select:</span>

                    <!-- Indices -->
                    <div class="flex items-center space-x-1">
                        <span class="text-xs text-purple-600 font-medium">Indices:</span>
                        <button onclick="changeSymbol('NSE:NIFTY50-INDEX')"
                                class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs hover:bg-purple-200">
                            NIFTY50
                        </button>
                        <button onclick="changeSymbol('NSE:NIFTYBANK-INDEX')"
                                class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs hover:bg-purple-200">
                            BANKNIFTY
                        </button>
                    </div>

                    <!-- Blue Chip Stocks -->
                    <div class="flex items-center space-x-1">
                        <span class="text-xs text-blue-600 font-medium">Stocks:</span>
                        <button onclick="changeSymbol('NSE:RELIANCE-EQ')"
                                class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200">RELIANCE
                        </button>
                        <button onclick="changeSymbol('NSE:TCS-EQ')"
                                class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200">TCS
                        </button>
                        <button onclick="changeSymbol('NSE:INFY-EQ')"
                                class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200">INFY
                        </button>
                        <button onclick="changeSymbol('NSE:HDFCBANK-EQ')"
                                class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200">HDFC BANK
                        </button>
                        <button onclick="changeSymbol('NSE:ICICIBANK-EQ')"
                                class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200">ICICI BANK
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Live Price Display Dashboard -->
        <div class="grid md:grid-cols-5 gap-4 mb-6">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-lg text-white transform transition-all duration-300 hover:scale-105">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-medium opacity-90">Current Price</h3>
                        <p class="text-xl font-bold" id="current-price">‚Çπ--</p>
                        <div class="text-xs opacity-75" id="price-time">--</div>
                    </div>
                    <div class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"></path>
                            <path fill-rule="evenodd"
                                  d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"
                                  clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-lg text-white transform transition-all duration-300 hover:scale-105">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-medium opacity-90">Change</h3>
                        <p class="text-xl font-bold" id="price-change">--</p>
                        <div class="text-xs opacity-75" id="change-percent">--</div>
                    </div>
                    <div class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                  d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z"
                                  clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-4 rounded-lg text-white transform transition-all duration-300 hover:scale-105">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-medium opacity-90">Volume</h3>
                        <p class="text-xl font-bold" id="current-volume">--</p>
                        <div class="text-xs opacity-75" id="volume-change">--</div>
                    </div>
                    <div class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-gradient-to-r from-orange-500 to-orange-600 p-4 rounded-lg text-white transform transition-all duration-300 hover:scale-105">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-medium opacity-90">High / Low</h3>
                        <p class="text-lg font-bold" id="day-high-low">-- / --</p>
                        <div class="text-xs opacity-75" id="day-range">Range: --</div>
                    </div>
                    <div class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                  d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732L14.146 12.8l-1.179 4.456a1 1 0 01-1.934 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732L9.854 7.2l1.179-4.456A1 1 0 0112 2z"
                                  clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-gradient-to-r from-indigo-500 to-indigo-600 p-4 rounded-lg text-white transform transition-all duration-300 hover:scale-105">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-medium opacity-90">Data Points</h3>
                        <p class="text-xl font-bold" id="data-points">--</p>
                        <div class="text-xs opacity-75" id="chart-status">--</div>
                    </div>
                    <div class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                  d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                  clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Chart Controls -->
        <div class="mb-4 space-y-3">
            <!-- Timeframe and Interval Controls -->
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div class="flex items-center space-x-2">
                    <span class="text-sm font-medium text-gray-700">Timeframe:</span>
                    <button onclick="changeTimeframe('1')"
                            class="px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm hover:bg-blue-200 timeframe-btn"
                            data-timeframe="1">1D
                    </button>
                    <button onclick="changeTimeframe('3')"
                            class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 timeframe-btn"
                            data-timeframe="3">3D
                    </button>
                    <button onclick="changeTimeframe('5')"
                            class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 timeframe-btn"
                            data-timeframe="5">5D
                    </button>
                    <button onclick="changeTimeframe('10')"
                            class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 timeframe-btn"
                            data-timeframe="10">10D
                    </button>
                    <button onclick="changeTimeframe('30')"
                            class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 timeframe-btn"
                            data-timeframe="30">1M
                    </button>
                </div>

                <div class="flex items-center space-x-2">
                    <span class="text-sm font-medium text-gray-700">Interval:</span>
                    <button onclick="changeInterval('1')"
                            class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 interval-btn"
                            data-interval="1">1m
                    </button>
                    <button onclick="changeInterval('5')"
                            class="px-3 py-1 bg-green-100 text-green-700 rounded text-sm hover:bg-green-200 interval-btn"
                            data-interval="5">5m
                    </button>
                    <button onclick="changeInterval('15')"
                            class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 interval-btn"
                            data-interval="15">15m
                    </button>
                    <button onclick="changeInterval('60')"
                            class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 interval-btn"
                            data-interval="60">1h
                    </button>
                    <button onclick="changeInterval('D')"
                            class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 interval-btn"
                            data-interval="D">Daily
                    </button>
                </div>
            </div>

            <!-- Chart Controls -->
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div class="flex items-center space-x-2">
                    <span class="text-sm font-medium text-gray-700">Chart Tools:</span>
                    <button onclick="fitChart()"
                            class="px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm hover:bg-blue-200">
                        üìè Fit to Data
                    </button>
                    <button onclick="resetZoom()"
                            class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded text-sm hover:bg-yellow-200">
                        üîç Reset Zoom
                    </button>
                    <button onclick="toggleFullscreen()"
                            class="px-3 py-1 bg-purple-100 text-purple-700 rounded text-sm hover:bg-purple-200">
                        üì∫ Fullscreen
                    </button>
                    <button onclick="downloadChart()"
                            class="px-3 py-1 bg-green-100 text-green-700 rounded text-sm hover:bg-green-200">
                        üíæ Download
                    </button>
                </div>

                <div class="flex items-center space-x-2">
                    <span class="text-sm font-medium text-gray-700">Settings:</span>
                    <label class="flex items-center">
                        <input type="checkbox" id="auto-fit" checked class="mr-1">
                        <span class="text-sm">Auto-fit</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="show-volume" checked class="mr-1">
                        <span class="text-sm">Volume</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="price-line" checked class="mr-1">
                        <span class="text-sm">Price Line</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Enhanced TradingView Chart Container -->
        <div class="bg-gradient-to-br from-gray-50 to-gray-100 p-4 rounded-lg shadow-inner">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold">Real-Time Candlestick Chart</h2>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-500">
                        <span id="chart-info">Loading chart...</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse" id="chart-status-indicator"></div>
                        <span class="text-xs text-gray-500" id="chart-status-text">Initializing</span>
                    </div>
                </div>
            </div>

            <div class="relative bg-white rounded-lg shadow-lg" style="height: 700px;">
                <!-- Chart Container -->
                <div id="candlestick-chart" style="height: 100%; width: 100%; border-radius: 8px;"></div>

                <!-- Loading Overlay -->
                <div id="chart-loading"
                     class="absolute inset-0 flex items-center justify-center bg-white bg-opacity-95 rounded-lg">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4"></div>
                        <p class="text-lg font-medium text-gray-700">Loading chart data...</p>
                        <p class="text-sm text-gray-500 mt-2">Fetching historical candles and setting up real-time
                            feed</p>
                    </div>
                </div>

                <!-- No Data Overlay -->
                <div id="no-data-message"
                     class="absolute inset-0 flex items-center justify-center bg-white rounded-lg hidden">
                    <div class="text-center">
                        <svg class="w-20 h-20 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor"
                             viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">No Chart Data Available</h3>
                        <p class="text-gray-500 mb-6">Unable to load historical data for this symbol.<br>This might be
                            due to market closure or data unavailability.</p>
                        <div class="space-x-2">
                            <button onclick="loadHistoricalData()"
                                    class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded">
                                üîÑ Retry Loading
                            </button>
                            <button onclick="changeSymbol('NSE:RELIANCE-EQ')"
                                    class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded">
                                üìà Try RELIANCE
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Chart Watermark -->
                <div class="absolute bottom-4 right-4 text-xs text-gray-400 pointer-events-none">
                    Real-time data powered by Fyers API
                </div>
            </div>
        </div>

        <!-- Enhanced Debug Panel -->
        <div class="mt-6">
            <button onclick="toggleDebugPanel()" class="text-sm text-gray-500 hover:text-gray-700">
                üîß <span id="debug-toggle-text">Show Debug Panel</span>
            </button>
            <div id="debug-panel" class="hidden mt-4 p-4 bg-gray-900 text-green-400 rounded-lg font-mono text-sm">
                <div class="flex justify-between items-center mb-2">
                    <strong class="text-green-300">Debug Console</strong>
                    <button onclick="clearDebugLog()" class="text-red-400 hover:text-red-300">Clear</button>
                </div>
                <div id="debug-output" class="max-h-40 overflow-y-auto"></div>
            </div>
        </div>
    </div>
</div>

<!-- TradingView Lightweight Charts -->
<script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>

<script>
    // Global variables
    let socket;
    let chart;
    let candlestickSeries;
    let volumeSeries;
    let currentSymbol = '{{ symbol or "NSE:RELIANCE-EQ" }}';
    let currentTimeframe = '5';
    let currentInterval = '5';
    let lastPrice = null;
    let currentLastCandle = null;
    let updateCounter = 0;
    let lastVolume = 0;
    let dayHigh = 0;
    let dayLow = Number.MAX_VALUE;

    // Debug and UI functions
    function debugLog(message) {
        console.log(message);
        updateDebugPanel(message);
        updateChartStatus(message);
    }

    function updateDebugPanel(message) {
        const debugOutput = document.getElementById('debug-output');
        const timestamp = new Date().toLocaleTimeString();
        debugOutput.innerHTML += `<div class="text-xs opacity-75">[${timestamp}]</div><div class="mb-2">${message}</div>`;
        debugOutput.scrollTop = debugOutput.scrollHeight;
    }

    function updateChartStatus(message) {
        document.getElementById('chart-status-text').textContent = message.substring(0, 20) + '...';
    }

    function clearDebugLog() {
        document.getElementById('debug-output').innerHTML = '';
    }

    function toggleDebugPanel() {
        const panel = document.getElementById('debug-panel');
        const toggleText = document.getElementById('debug-toggle-text');

        if (panel.classList.contains('hidden')) {
            panel.classList.remove('hidden');
            toggleText.textContent = 'Hide Debug Panel';
        } else {
            panel.classList.add('hidden');
            toggleText.textContent = 'Show Debug Panel';
        }
    }

    // Initialize Socket.IO
    function initializeSocket() {
        debugLog('üîå Initializing WebSocket connection...');
        socket = io();

        socket.on('connect', function() {
            debugLog('‚úÖ WebSocket connected successfully');
            updateConnectionStatus('connected');
            if (currentSymbol) {
                subscribeToSymbol(currentSymbol);
            }
        });

        socket.on('disconnect', function() {
            debugLog('‚ùå WebSocket disconnected');
            updateConnectionStatus('disconnected');
        });

        socket.on('market_data', function(data) {
            debugLog(`üìä Received live data for ${data.symbol}: LTP=‚Çπ${data.ltp}`);
            handleMarketData(data);
        });

        socket.on('subscribed', function(data) {
            debugLog(`‚úÖ Subscribed to live data: ${data.symbol}`);
            updateConnectionStatus('subscribed', data.symbol);
        });

        socket.on('error', function(data) {
            debugLog(`‚ùå Socket error: ${JSON.stringify(data)}`);
        });
    }

    // Connection status management
    function updateConnectionStatus(status, symbol = null) {
        const indicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');

        switch (status) {
            case 'connected':
                indicator.className = 'w-2 h-2 bg-yellow-500 rounded-full mr-2 animate-pulse';
                statusText.textContent = 'Connected';
                break;
            case 'subscribed':
                indicator.className = 'w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse';
                statusText.textContent = `üî¥ Live - ${symbol}`;
                break;
            case 'disconnected':
                indicator.className = 'w-2 h-2 bg-red-500 rounded-full mr-2';
                statusText.textContent = '‚ö†Ô∏è Disconnected';
                break;
        }
    }

    // Symbol management
    function subscribeToSymbol(symbol) {
        if (socket && socket.connected) {
            socket.emit('subscribe', { symbol: symbol });
            debugLog(`üì° Subscribing to ${symbol}...`);
        }
    }

    function unsubscribeFromSymbol(symbol) {
        if (socket && socket.connected) {
            socket.emit('unsubscribe', { symbol: symbol });
            debugLog(`üì° Unsubscribing from ${symbol}`);
        }
    }

    // Market data handling
    function handleMarketData(data) {
        try {
            updateCounter++;
            document.getElementById('update-counter').textContent = updateCounter;

            // Update price display
            updatePriceDisplay(data);

            // Update chart with new live data
            updateCandlestickChart(data);

            // Update timestamp
            updateTimestamp();

        } catch (error) {
            debugLog(`‚ùå Error handling market data: ${error.message}`);
        }
    }

    // Enhanced price display updates
    function updatePriceDisplay(data) {
        if (data.ltp) {
            const price = parseFloat(data.ltp);
            document.getElementById('current-price').textContent = `‚Çπ${price.toFixed(2)}`;
            document.getElementById('price-time').textContent = new Date().toLocaleTimeString();
            // Update day high/low
           if (price > dayHigh) dayHigh = price;
           if (price < dayLow) dayLow = price;

           document.getElementById('day-high-low').textContent = `‚Çπ${dayHigh.toFixed(2)} / ‚Çπ${dayLow.toFixed(2)}`;
           const range = ((dayHigh - dayLow) / dayLow * 100).toFixed(2);
           document.getElementById('day-range').textContent = `Range: ${range}%`;

           // Add/update price line on chart
           if (document.getElementById('price-line').checked) {
               addCurrentPriceLine(price);
           }

           // Price change animation
           if (lastPrice !== null) {
               const priceEl = document.getElementById('current-price');
               if (price > lastPrice) {
                   priceEl.className = 'text-xl font-bold text-green-300 animate-pulse';
                   setTimeout(() => priceEl.classList.remove('animate-pulse'), 1000);
               } else if (price < lastPrice) {
                   priceEl.className = 'text-xl font-bold text-red-300 animate-pulse';
                   setTimeout(() => priceEl.classList.remove('animate-pulse'), 1000);
               }
           }
           lastPrice = price;
       }

       if (data.ch !== undefined && data.chp !== undefined) {
           const change = parseFloat(data.ch);
           const changePercent = parseFloat(data.chp);
           const changeEl = document.getElementById('price-change');
           const changePercentEl = document.getElementById('change-percent');

           changeEl.textContent = `${change >= 0 ? '+' : ''}‚Çπ${change.toFixed(2)}`;
           changePercentEl.textContent = `${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%`;

           const colorClass = change >= 0 ? 'text-xl font-bold text-green-300' : 'text-xl font-bold text-red-300';
           changeEl.className = colorClass;
       }

       if (data.volume !== undefined) {
           const volume = parseInt(data.volume);
           document.getElementById('current-volume').textContent = formatVolume(volume);

           // Volume change indicator
           if (lastVolume > 0) {
               const volumeChangePercent = ((volume - lastVolume) / lastVolume * 100).toFixed(1);
               document.getElementById('volume-change').textContent = `${volumeChangePercent >= 0 ? '+' : ''}${volumeChangePercent}%`;
           }
           lastVolume = volume;
       }
   }

   // Enhanced volume formatting
   function formatVolume(volume) {
       if (volume >= 10000000) return (volume / 10000000).toFixed(1) + 'Cr';
       if (volume >= 100000) return (volume / 100000).toFixed(1) + 'L';
       if (volume >= 1000) return (volume / 1000).toFixed(1) + 'K';
       return volume.toString();
   }

   // Update timestamp
   function updateTimestamp() {
       document.getElementById('update-time').textContent = new Date().toLocaleTimeString();
   }

   // Enhanced TradingView chart initialization
   function initializeTradingViewChart() {
       debugLog('üìà Initializing enhanced TradingView chart...');

       const chartContainer = document.getElementById('candlestick-chart');

       if (!chartContainer) {
           debugLog('‚ùå Chart container not found');
           return;
       }

       if (typeof LightweightCharts === 'undefined') {
           debugLog('‚ùå TradingView library not loaded');
           showNoDataMessage('TradingView library not loaded');
           return;
       }

       try {
           chart = LightweightCharts.createChart(chartContainer, {
               width: chartContainer.clientWidth,
               height: 700,
               layout: {
                   backgroundColor: '#ffffff',
                   textColor: '#333333',
                   fontSize: 12,
                   fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
               },
               grid: {
                   vertLines: {
                       color: 'rgba(42, 46, 57, 0.06)',
                       style: LightweightCharts.LineStyle.Solid,
                   },
                   horzLines: {
                       color: 'rgba(42, 46, 57, 0.06)',
                       style: LightweightCharts.LineStyle.Solid,
                   },
               },
               crosshair: {
                   mode: LightweightCharts.CrosshairMode.Normal,
                   vertLine: {
                       color: 'rgba(32, 38, 46, 0.7)',
                       width: 1,
                       style: LightweightCharts.LineStyle.Dashed,
                   },
                   horzLine: {
                       color: 'rgba(32, 38, 46, 0.7)',
                       width: 1,
                       style: LightweightCharts.LineStyle.Dashed,
                   },
               },
               rightPriceScale: {
                   borderColor: 'rgba(197, 203, 206, 0.4)',
                   borderVisible: true,
                   textColor: '#333333',
                   entireTextOnly: true,
               },
               timeScale: {
                   borderColor: 'rgba(197, 203, 206, 0.4)',
                   borderVisible: true,
                   timeVisible: true,
                   secondsVisible: false,
                   fixLeftEdge: false,
                   fixRightEdge: false,
                   lockVisibleTimeRangeOnResize: true,
               },
               handleScroll: {
                   mouseWheel: true,
                   pressedMouseMove: true,
                   horzTouchDrag: true,
                   vertTouchDrag: true,
               },
               handleScale: {
                   axisPressedMouseMove: true,
                   mouseWheel: true,
                   pinch: true,
               },
           });

           debugLog('üìä Adding candlestick series...');

           // Enhanced candlestick series
           candlestickSeries = chart.addCandlestickSeries({
               upColor: '#26a69a',
               downColor: '#ef5350',
               borderVisible: false,
               wickUpColor: '#26a69a',
               wickDownColor: '#ef5350',
               priceFormat: {
                   type: 'price',
                   precision: 2,
                   minMove: 0.01,
               },
           });

           debugLog('üìä Adding volume series...');

           // Enhanced volume series
           volumeSeries = chart.addHistogramSeries({
               color: '#26a69a',
               priceFormat: {
                   type: 'volume',
               },
               priceScaleId: 'volume',
               scaleMargins: {
                   top: 0.7,
                   bottom: 0,
               },
           });

           // Configure volume price scale
           chart.priceScale('volume').applyOptions({
               scaleMargins: {
                   top: 0.7,
                   bottom: 0,
               },
               borderVisible: false,
               textColor: '#888888',
           });

           // Configure main price scale
           chart.priceScale('right').applyOptions({
               scaleMargins: {
                   top: 0.1,
                   bottom: 0.3,
               },
               borderVisible: true,
               textColor: '#333333',
           });

           // Add legend
           addChartLegend();

           debugLog('‚úÖ TradingView chart initialized successfully');

           // Handle resize
           const resizeObserver = new ResizeObserver(entries => {
               if (chart) {
                   chart.applyOptions({ width: chartContainer.clientWidth });
               }
           });
           resizeObserver.observe(chartContainer);

           // Load initial data
           setTimeout(() => {
               loadHistoricalData();
           }, 500);

       } catch (error) {
           debugLog(`‚ùå Error creating chart: ${error.message}`);
           console.error('Chart creation error:', error);
           showNoDataMessage(`Chart initialization failed: ${error.message}`);
       }
   }

   // Add chart legend
   function addChartLegend() {
       // This is a simplified legend - you can enhance it further
       document.getElementById('chart-status').textContent = 'Chart Ready';
   }

   // Enhanced historical data loading
   function loadHistoricalData() {
       debugLog(`üìà Loading historical data for ${currentSymbol}...`);

       document.getElementById('chart-loading').style.display = 'flex';
       document.getElementById('no-data-message').classList.add('hidden');
       document.getElementById('chart-status').textContent = 'Loading...';

       const url = `/api/historical_data?symbol=${encodeURIComponent(currentSymbol)}&timeframe=${currentTimeframe}&interval=${currentInterval}`;

       fetch(url)
           .then(response => {
               debugLog(`üìä API response status: ${response.status}`);
               if (!response.ok) {
                   throw new Error(`HTTP ${response.status}: ${response.statusText}`);
               }
               return response.json();
           })
           .then(data => {
               debugLog(`üìä API response: success=${data.success}, count=${data.count || 0}`);

               if (data.success && data.data && data.data.length > 0) {
                   displayChartData(data.data, data.count);

                   // Initialize day high/low from historical data
                   initializeDayHighLow(data.data);
               } else {
                   const errorMsg = data.error || data.message || 'No data available for this symbol';
                   showNoDataMessage(errorMsg);
                   debugLog(`‚ö†Ô∏è No data: ${errorMsg}`);
               }
           })
           .catch(error => {
               debugLog(`‚ùå Error fetching data: ${error.message}`);
               showNoDataMessage(`Network error: ${error.message}`);
           })
           .finally(() => {
               document.getElementById('chart-loading').style.display = 'none';
           });
   }

   // Initialize day high/low from historical data
   function initializeDayHighLow(data) {
       if (data.length === 0) return;

       // Get today's data (last few candles)
       const todayCandles = data.slice(-50); // Last 50 candles

       dayHigh = Math.max(...todayCandles.map(c => c.high));
       dayLow = Math.min(...todayCandles.map(c => c.low));

       document.getElementById('day-high-low').textContent = `‚Çπ${dayHigh.toFixed(2)} / ‚Çπ${dayLow.toFixed(2)}`;
       const range = ((dayHigh - dayLow) / dayLow * 100).toFixed(2);
       document.getElementById('day-range').textContent = `Range: ${range}%`;
   }

   // Enhanced chart data display
   function displayChartData(data, count) {
       try {
           debugLog(`üìä Processing ${count} candles for chart...`);

           if (!candlestickSeries || !volumeSeries) {
               debugLog('‚ùå Chart series not initialized');
               showNoDataMessage('Chart series not initialized');
               return;
           }

           if (data.length === 0) {
               debugLog('‚ö†Ô∏è No candles to display');
               showNoDataMessage('No valid candle data to display');
               return;
           }

           // Process and validate data
           const candlestickData = [];
           const volumeData = [];
           let validCandles = 0;

           for (let i = 0; i < data.length; i++) {
               const candle = data[i];

               if (!candle.time && !candle.timestamp) {
                   continue;
               }

               const time = candle.time || candle.timestamp;
               const open = parseFloat(candle.open);
               const high = parseFloat(candle.high);
               const low = parseFloat(candle.low);
               const close = parseFloat(candle.close);
               const volume = parseInt(candle.volume) || 0;

               // Validate OHLC values
               if (isNaN(open) || isNaN(high) || isNaN(low) || isNaN(close) || high < low) {
                   continue;
               }

               candlestickData.push({ time, open, high, low, close });
               volumeData.push({
                   time: time,
                   value: volume,
                   color: close >= open ? 'rgba(38, 166, 154, 0.8)' : 'rgba(239, 83, 80, 0.8)'
               });

               validCandles++;
           }

           debugLog(`‚úÖ Processed ${validCandles} valid candles`);

           if (validCandles === 0) {
               showNoDataMessage('No valid candle data found');
               return;
           }

           // Set data to chart
           candlestickSeries.setData(candlestickData);

           // Show/hide volume based on checkbox
           if (document.getElementById('show-volume').checked) {
               volumeSeries.setData(volumeData);
           }

           // Store the last candle for live updates
           if (candlestickData.length > 0) {
               currentLastCandle = candlestickData[candlestickData.length - 1];
           }

           // Update info displays
           document.getElementById('chart-info').textContent = `${validCandles} candles ‚Ä¢ ${currentTimeframe}D ‚Ä¢ ${currentInterval}m interval`;
           document.getElementById('data-points').textContent = validCandles;
           document.getElementById('chart-status').textContent = 'Live Updates Active';

           debugLog(`‚úÖ Chart updated successfully with ${validCandles} candles`);

           // Auto-fit if enabled
           if (document.getElementById('auto-fit').checked) {
               setTimeout(() => fitChart(), 100);
           }

       } catch (error) {
           debugLog(`‚ùå Error displaying chart data: ${error.message}`);
           console.error('Chart display error:', error);
           showNoDataMessage(`Chart error: ${error.message}`);
       }
   }

   // Enhanced real-time candle updates
   function updateCandlestickChart(data) {
       if (!chart || !candlestickSeries || !data.ltp) return;

       try {
           const now = new Date();
           const price = parseFloat(data.ltp);
           const volume = data.volume ? parseInt(data.volume) : 0;

           // Calculate time bucket based on interval
           let intervalMs;
           switch (currentInterval) {
               case '1': intervalMs = 60 * 1000; break;
               case '5': intervalMs = 5 * 60 * 1000; break;
               case '15': intervalMs = 15 * 60 * 1000; break;
               case '60': intervalMs = 60 * 60 * 1000; break;
               case 'D': intervalMs = 24 * 60 * 60 * 1000; break;
               default: intervalMs = 5 * 60 * 1000; break;
           }

           const bucketTime = Math.floor(now.getTime() / intervalMs) * intervalMs;
           const unixTime = Math.floor(bucketTime / 1000);

           if (currentLastCandle && currentLastCandle.time === unixTime) {
               // Update existing candle
               const updatedCandle = {
                   time: unixTime,
                   open: currentLastCandle.open,
                   high: Math.max(currentLastCandle.high, price),
                   low: Math.min(currentLastCandle.low, price),
                   close: price
               };

               const updatedVolume = {
                   time: unixTime,
                   value: volume,
                   color: price >= updatedCandle.open ? 'rgba(38, 166, 154, 0.8)' : 'rgba(239, 83, 80, 0.8)'
               };

               candlestickSeries.update(updatedCandle);
               if (document.getElementById('show-volume').checked) {
                   volumeSeries.update(updatedVolume);
               }

               currentLastCandle = updatedCandle;
               debugLog(`üîÑ Updated candle: ‚Çπ${price} (H:${updatedCandle.high.toFixed(2)}, L:${updatedCandle.low.toFixed(2)})`);
           } else {
               // Create new candle
               const newCandle = {
                   time: unixTime,
                   open: price,
                   high: price,
                   low: price,
                   close: price
               };

               const newVolume = {
                   time: unixTime,
                   value: volume,
                   color: 'rgba(38, 166, 154, 0.8)'
               };

               candlestickSeries.update(newCandle);
               if (document.getElementById('show-volume').checked) {
                   volumeSeries.update(newVolume);
               }

               currentLastCandle = newCandle;
               debugLog(`üÜï New candle created at ${new Date(bucketTime).toLocaleTimeString()}: ‚Çπ${price}`);

               // Auto-scroll to show latest data if enabled
               if (document.getElementById('auto-fit').checked) {
                   chart.timeScale().scrollToRealTime();
               }
           }

       } catch (error) {
           debugLog(`‚ùå Error updating candlestick chart: ${error.message}`);
       }
   }

   // Price line management
   function addCurrentPriceLine(price) {
       if (!candlestickSeries || !price) return;

       try {
           // Remove existing price line
           if (window.currentPriceLine) {
               candlestickSeries.removePriceLine(window.currentPriceLine);
           }

           // Add new price line
           window.currentPriceLine = candlestickSeries.createPriceLine({
               price: parseFloat(price),
               color: '#2196F3',
               lineWidth: 2,
               lineStyle: LightweightCharts.LineStyle.Dashed,
               axisLabelVisible: true,
               title: `‚Çπ${price.toFixed(2)}`,
           });

       } catch (error) {
           debugLog(`‚ùå Error adding price line: ${error.message}`);
       }
   }

   // Show no data message
   function showNoDataMessage(message) {
       document.getElementById('no-data-message').classList.remove('hidden');
       document.getElementById('chart-info').textContent = message;
       document.getElementById('data-points').textContent = '0';
       document.getElementById('chart-status').textContent = 'No Data';
   }

   // Enhanced symbol change
   function changeSymbol(symbol) {
       debugLog(`üîÑ Changing symbol to: ${symbol}`);

       if (currentSymbol) {
           unsubscribeFromSymbol(currentSymbol);
       }

       currentSymbol = symbol;
       document.getElementById('current-symbol').textContent = symbol;

       // Reset counters and data
       updateCounter = 0;
       lastPrice = null;
       lastVolume = 0;
       dayHigh = 0;
       dayLow = Number.MAX_VALUE;
       currentLastCandle = null;

       // Clear price line
       if (window.currentPriceLine && candlestickSeries) {
           candlestickSeries.removePriceLine(window.currentPriceLine);
           window.currentPriceLine = null;
       }

       // Reset displays
       document.getElementById('update-counter').textContent = '0';
       document.getElementById('current-price').textContent = '‚Çπ--';
       document.getElementById('price-change').textContent = '--';
       document.getElementById('current-volume').textContent = '--';
       document.getElementById('day-high-low').textContent = '-- / --';

       // Subscribe to new symbol and load data
       subscribeToSymbol(symbol);
       loadHistoricalData();
   }

   // Enhanced timeframe change
   function changeTimeframe(timeframe) {
       currentTimeframe = timeframe;
       updateButtonStates('timeframe', timeframe);

       debugLog(`üìÖ Changed timeframe to: ${timeframe} days`);

       // Reset last candle
       currentLastCandle = null;

       loadHistoricalData();
   }

   // Enhanced interval change
   function changeInterval(interval) {
       currentInterval = interval;
       updateButtonStates('interval', interval);

       debugLog(`‚è±Ô∏è Changed interval to: ${interval}`);

       // Reset last candle for new interval
       currentLastCandle = null;

       loadHistoricalData();
   }

   // Update button states
   function updateButtonStates(type, activeValue) {
       const buttons = document.querySelectorAll(`.${type}-btn`);
       buttons.forEach(btn => {
           const value = btn.dataset[type];
           if (value === activeValue) {
               btn.className = btn.className.replace(/bg-gray-\d+/g, 'bg-blue-100').replace(/text-gray-\d+/g, 'text-blue-700');
           } else {
               btn.className = btn.className.replace(/bg-blue-\d+/g, 'bg-gray-100').replace(/text-blue-\d+/g, 'text-gray-700');
           }
       });
   }

   // Chart control functions
   function fitChart() {
       if (chart) {
           chart.timeScale().fitContent();
           debugLog('üìè Chart fitted to content');
       }
   }

   function resetZoom() {
       if (chart) {
           chart.timeScale().resetTimeScale();
           debugLog('üîç Chart zoom reset');
       }
   }

   function toggleFullscreen() {
       const chartContainer = document.getElementById('candlestick-chart').parentElement;

       if (!document.fullscreenElement) {
           chartContainer.requestFullscreen().then(() => {
               setTimeout(() => {
                   if (chart) {
                       chart.applyOptions({
                           width: window.innerWidth - 40,
                           height: window.innerHeight - 100
                       });
                   }
               }, 100);
               debugLog('üì∫ Entered fullscreen mode');
           });
       } else {
           document.exitFullscreen().then(() => {
               setTimeout(() => {
                   if (chart) {
                       const container = document.getElementById('candlestick-chart');
                       chart.applyOptions({
                           width: container.clientWidth,
                           height: 700
                       });
                   }
               }, 100);
               debugLog('üì∫ Exited fullscreen mode');
           });
       }
   }

   function downloadChart() {
       // This is a placeholder - you can implement screenshot functionality
       debugLog('üíæ Chart download feature coming soon...');
       alert('Chart download feature will be implemented soon!');
   }

   // Enhanced search functionality
   document.addEventListener('DOMContentLoaded', function() {
       debugLog('üöÄ Page loaded, initializing real-time trading chart...');

       // Check TradingView library
       if (typeof LightweightCharts !== 'undefined') {
           debugLog('‚úÖ TradingView library loaded successfully');
           initializeTradingViewChart();
       } else {
           debugLog('‚ùå TradingView library not loaded');
       }

       // Initialize WebSocket
       initializeSocket();

       // Initialize market status
       updateMarketStatus();

       // Set up search functionality
       setupAdvancedSearch();

       // Set up settings listeners
       setupSettingsListeners();
   });

   // Advanced search setup
   function setupAdvancedSearch() {
       const searchInput = document.getElementById('instrument-search');
       const resultsDiv = document.getElementById('search-results');
       const loadingDiv = document.getElementById('search-loading');

       let searchTimeout;
       let currentRequest;

       searchInput.addEventListener('input', function() {
           const query = searchInput.value.trim();

           clearTimeout(searchTimeout);

           if (currentRequest) {
               currentRequest.abort();
           }

           if (query.length < 2) {
               resultsDiv.innerHTML = '';
               resultsDiv.classList.add('hidden');
               loadingDiv.classList.add('hidden');
               return;
           }

           loadingDiv.classList.remove('hidden');

           searchTimeout = setTimeout(() => {
               performAdvancedSearch(query);
           }, 300);
       });

       // Hide results when clicking outside
       document.addEventListener('click', function(event) {
           if (!searchInput.contains(event.target) && !resultsDiv.contains(event.target)) {
               resultsDiv.classList.add('hidden');
           }
       });
   }

   function performAdvancedSearch(query) {
       const controller = new AbortController();
       currentRequest = controller;

       fetch(`/api/search_instruments?q=${encodeURIComponent(query)}&limit=15`, {
           signal: controller.signal
       })
       .then(response => response.json())
       .then(data => {
           document.getElementById('search-loading').classList.add('hidden');
           currentRequest = null;

           const resultsDiv = document.getElementById('search-results');

           if (data.length === 0) {
               resultsDiv.innerHTML = '<div class="p-3 text-sm text-gray-500 text-center">No instruments found matching your search</div>';
           } else {
               let html = '';
               data.forEach(item => {
                   const symbol = `${item.exchange}:${item.symbol}`;
                   html += `
                       <div onclick="changeSymbol('${symbol}')"
                            class="flex items-center justify-between p-3 hover:bg-blue-50 border-b border-gray-100 cursor-pointer group">
                           <div class="flex-1">
                               <div class="font-semibold text-gray-900 group-hover:text-blue-600">${item.symbol}</div>
                               <div class="text-sm text-gray-500">${item.name || 'N/A'}</div>
                           </div>
                           <div class="text-right">
                               <div class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">${item.exchange}</div>
                           </div>
                       </div>
                   `;
               });
               resultsDiv.innerHTML = html;
           }
           resultsDiv.classList.remove('hidden');
       })
       .catch(error => {
           document.getElementById('search-loading').classList.add('hidden');
           currentRequest = null;

           if (error.name === 'AbortError') return;

           console.error('Search error:', error);
           document.getElementById('search-results').innerHTML =
               '<div class="p-3 text-sm text-red-500 text-center">Error searching instruments</div>';
       });
   }

   // Settings listeners
   function setupSettingsListeners() {
       // Volume toggle
       document.getElementById('show-volume').addEventListener('change', function() {
           if (volumeSeries) {
               if (this.checked) {
                   // Show volume - reload data
                   loadHistoricalData();
               } else {
                   // Hide volume
                   volumeSeries.setData([]);
               }
           }
       });

       // Price line toggle
       document.getElementById('price-line').addEventListener('change', function() {
           if (!this.checked && window.currentPriceLine && candlestickSeries) {
               candlestickSeries.removePriceLine(window.currentPriceLine);
               window.currentPriceLine = null;
           }
       });
   }

   // Market status update
   function updateMarketStatus() {
       const now = new Date();
       const day = now.getDay();
       const hours = now.getHours();
       const minutes = now.getMinutes();
       const time = hours * 100 + minutes;

       let status = '';
       if (day === 0 || day === 6) {
           status = 'üî¥ Market Closed - Weekend';
       } else if (time >= 915 && time <= 1530) {
           status = 'üü¢ Market Open';
       } else if (time < 915) {
           status = 'üü° Pre-Market';
       } else {
           status = 'üî¥ Market Closed';
       }

       document.getElementById('market-status-text').textContent = status;
   }

   // Handle fullscreen changes
   document.addEventListener('fullscreenchange', function() {
       if (chart) {
           setTimeout(() => {
               const container = document.getElementById('candlestick-chart');
               if (document.fullscreenElement) {
                   chart.applyOptions({
                       width: window.innerWidth - 40,
                       height: window.innerHeight - 100
                   });
               } else {
                   chart.applyOptions({
                       width: container.clientWidth,
                       height: 700
                   });
               }
           }, 100);
       }
   });

   // Cleanup on page unload
   window.addEventListener('beforeunload', function() {
       if (socket && currentSymbol) {
           unsubscribeFromSymbol(currentSymbol);
           socket.disconnect();
       }
   });

   // Update market status every minute
   setInterval(updateMarketStatus, 60000);
</script>

<style>
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    .animate-spin {
        animation: spin 1s linear infinite;
    }

    .animate-pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    .transform {
        transform: translateZ(0);
    }

    .hover\:scale-105:hover {
        transform: scale(1.05);
    }

    /* Custom scrollbar for debug panel */
    #debug-output {
        scrollbar-width: thin;
        scrollbar-color: #4ade80 #1f2937;
    }

    #debug-output::-webkit-scrollbar {
        width: 6px;
    }

    #debug-output::-webkit-scrollbar-track {
        background: #1f2937;
    }

    #debug-output::-webkit-scrollbar-thumb {
        background-color: #4ade80;
        border-radius: 3px;
    }

    /* Enhanced hover effects */
    .group:hover .group-hover\:text-blue-600 {
        color: #2563eb;
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
        .grid {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }

        .md\:grid-cols-5 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
    }
</style>
{% endblock %}